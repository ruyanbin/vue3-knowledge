{"ast":null,"code":"import { PNTSLoaderBase } from '../base/PNTSLoaderBase.js';\nimport { Points, PointsMaterial, BufferGeometry, BufferAttribute, DefaultLoadingManager } from 'three';\nexport class PNTSLoader extends PNTSLoaderBase {\n  constructor(manager = DefaultLoadingManager) {\n    super();\n    this.manager = manager;\n  }\n  parse(buffer) {\n    return super.parse(buffer).then(result => {\n      const {\n        featureTable\n      } = result;\n      const POINTS_LENGTH = featureTable.getData('POINTS_LENGTH');\n      const POSITION = featureTable.getData('POSITION', POINTS_LENGTH, 'FLOAT', 'VEC3');\n      const RGB = featureTable.getData('RGB', POINTS_LENGTH, 'UNSIGNED_BYTE', 'VEC3');\n      ['QUANTIZED_VOLUME_OFFSET', 'QUANTIZED_VOLUME_SCALE', 'CONSTANT_RGBA', 'BATCH_LENGTH', 'POSITION_QUANTIZED', 'RGBA', 'RGB565', 'NORMAL', 'NORMAL_OCT16P'].forEach(feature => {\n        if (feature in featureTable.header) {\n          console.warn(`PNTSLoader: Unsupported FeatureTable feature \"${feature}\" detected.`);\n        }\n      });\n      const geometry = new BufferGeometry();\n      geometry.setAttribute('position', new BufferAttribute(POSITION, 3, false));\n      const material = new PointsMaterial();\n      material.size = 2;\n      material.sizeAttenuation = false;\n      if (RGB !== null) {\n        geometry.setAttribute('color', new BufferAttribute(RGB, 3, true));\n        material.vertexColors = true;\n      }\n      const object = new Points(geometry, material);\n      result.scene = object;\n      result.scene.featureTable = featureTable;\n      const rtcCenter = featureTable.getData('RTC_CENTER');\n      if (rtcCenter) {\n        result.scene.position.x += rtcCenter[0];\n        result.scene.position.y += rtcCenter[1];\n        result.scene.position.z += rtcCenter[2];\n      }\n      return result;\n    });\n  }\n}","map":{"version":3,"names":["PNTSLoaderBase","Points","PointsMaterial","BufferGeometry","BufferAttribute","DefaultLoadingManager","PNTSLoader","constructor","manager","parse","buffer","then","result","featureTable","POINTS_LENGTH","getData","POSITION","RGB","forEach","feature","header","console","warn","geometry","setAttribute","material","size","sizeAttenuation","vertexColors","object","scene","rtcCenter","position","x","y","z"],"sources":["/Users/yanbinru/Desktop/代码/github/vue3-knowledge/node_modules/3d-tiles-renderer/src/three/PNTSLoader.js"],"sourcesContent":["import { PNTSLoaderBase } from '../base/PNTSLoaderBase.js';\nimport { Points, PointsMaterial, BufferGeometry, BufferAttribute, DefaultLoadingManager } from 'three';\n\nexport class PNTSLoader extends PNTSLoaderBase {\n\n\tconstructor( manager = DefaultLoadingManager ) {\n\n\t\tsuper();\n\t\tthis.manager = manager;\n\n\t}\n\n\tparse( buffer ) {\n\n\t\treturn super\n\t\t\t.parse( buffer )\n\t\t\t.then( result => {\n\n\t\t\t\tconst { featureTable } = result;\n\n\t\t\t\tconst POINTS_LENGTH = featureTable.getData( 'POINTS_LENGTH' );\n\t\t\t\tconst POSITION = featureTable.getData( 'POSITION', POINTS_LENGTH, 'FLOAT', 'VEC3' );\n\t\t\t\tconst RGB = featureTable.getData( 'RGB', POINTS_LENGTH, 'UNSIGNED_BYTE', 'VEC3' );\n\n\t\t\t\t[\n\t\t\t\t\t'QUANTIZED_VOLUME_OFFSET',\n\t\t\t\t\t'QUANTIZED_VOLUME_SCALE',\n\t\t\t\t\t'CONSTANT_RGBA',\n\t\t\t\t\t'BATCH_LENGTH',\n\t\t\t\t\t'POSITION_QUANTIZED',\n\t\t\t\t\t'RGBA',\n\t\t\t\t\t'RGB565',\n\t\t\t\t\t'NORMAL',\n\t\t\t\t\t'NORMAL_OCT16P',\n\t\t\t\t].forEach( feature => {\n\n\t\t\t\t\tif ( feature in featureTable.header ) {\n\n\t\t\t\t\t\tconsole.warn( `PNTSLoader: Unsupported FeatureTable feature \"${ feature }\" detected.` );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tconst geometry = new BufferGeometry();\n\t\t\t\tgeometry.setAttribute( 'position', new BufferAttribute( POSITION, 3, false ) );\n\n\t\t\t\tconst material = new PointsMaterial();\n\t\t\t\tmaterial.size = 2;\n\t\t\t\tmaterial.sizeAttenuation = false;\n\n\t\t\t\tif ( RGB !== null ) {\n\n\t\t\t\t\tgeometry.setAttribute( 'color', new BufferAttribute( RGB, 3, true ) );\n\t\t\t\t\tmaterial.vertexColors = true;\n\n\t\t\t\t}\n\n\t\t\t\tconst object = new Points( geometry, material );\n\t\t\t\tresult.scene = object;\n\t\t\t\tresult.scene.featureTable = featureTable;\n\n\t\t\t\tconst rtcCenter = featureTable.getData( 'RTC_CENTER' );\n\n\t\t\t\tif ( rtcCenter ) {\n\n\t\t\t\t\tresult.scene.position.x += rtcCenter[ 0 ];\n\t\t\t\t\tresult.scene.position.y += rtcCenter[ 1 ];\n\t\t\t\t\tresult.scene.position.z += rtcCenter[ 2 ];\n\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\n\t\t\t} );\n\n\t}\n\n}\n"],"mappings":"AAAA,SAASA,cAAc,QAAQ,2BAA2B;AAC1D,SAASC,MAAM,EAAEC,cAAc,EAAEC,cAAc,EAAEC,eAAe,EAAEC,qBAAqB,QAAQ,OAAO;AAEtG,OAAO,MAAMC,UAAU,SAASN,cAAc,CAAC;EAE9CO,WAAW,CAAEC,OAAO,GAAGH,qBAAqB,EAAG;IAE9C,KAAK,EAAE;IACP,IAAI,CAACG,OAAO,GAAGA,OAAO;EAEvB;EAEAC,KAAK,CAAEC,MAAM,EAAG;IAEf,OAAO,KAAK,CACVD,KAAK,CAAEC,MAAM,CAAE,CACfC,IAAI,CAAEC,MAAM,IAAI;MAEhB,MAAM;QAAEC;MAAa,CAAC,GAAGD,MAAM;MAE/B,MAAME,aAAa,GAAGD,YAAY,CAACE,OAAO,CAAE,eAAe,CAAE;MAC7D,MAAMC,QAAQ,GAAGH,YAAY,CAACE,OAAO,CAAE,UAAU,EAAED,aAAa,EAAE,OAAO,EAAE,MAAM,CAAE;MACnF,MAAMG,GAAG,GAAGJ,YAAY,CAACE,OAAO,CAAE,KAAK,EAAED,aAAa,EAAE,eAAe,EAAE,MAAM,CAAE;MAEjF,CACC,yBAAyB,EACzB,wBAAwB,EACxB,eAAe,EACf,cAAc,EACd,oBAAoB,EACpB,MAAM,EACN,QAAQ,EACR,QAAQ,EACR,eAAe,CACf,CAACI,OAAO,CAAEC,OAAO,IAAI;QAErB,IAAKA,OAAO,IAAIN,YAAY,CAACO,MAAM,EAAG;UAErCC,OAAO,CAACC,IAAI,CAAG,iDAAiDH,OAAS,aAAY,CAAE;QAExF;MAED,CAAC,CAAE;MAEH,MAAMI,QAAQ,GAAG,IAAIpB,cAAc,EAAE;MACrCoB,QAAQ,CAACC,YAAY,CAAE,UAAU,EAAE,IAAIpB,eAAe,CAAEY,QAAQ,EAAE,CAAC,EAAE,KAAK,CAAE,CAAE;MAE9E,MAAMS,QAAQ,GAAG,IAAIvB,cAAc,EAAE;MACrCuB,QAAQ,CAACC,IAAI,GAAG,CAAC;MACjBD,QAAQ,CAACE,eAAe,GAAG,KAAK;MAEhC,IAAKV,GAAG,KAAK,IAAI,EAAG;QAEnBM,QAAQ,CAACC,YAAY,CAAE,OAAO,EAAE,IAAIpB,eAAe,CAAEa,GAAG,EAAE,CAAC,EAAE,IAAI,CAAE,CAAE;QACrEQ,QAAQ,CAACG,YAAY,GAAG,IAAI;MAE7B;MAEA,MAAMC,MAAM,GAAG,IAAI5B,MAAM,CAAEsB,QAAQ,EAAEE,QAAQ,CAAE;MAC/Cb,MAAM,CAACkB,KAAK,GAAGD,MAAM;MACrBjB,MAAM,CAACkB,KAAK,CAACjB,YAAY,GAAGA,YAAY;MAExC,MAAMkB,SAAS,GAAGlB,YAAY,CAACE,OAAO,CAAE,YAAY,CAAE;MAEtD,IAAKgB,SAAS,EAAG;QAEhBnB,MAAM,CAACkB,KAAK,CAACE,QAAQ,CAACC,CAAC,IAAIF,SAAS,CAAE,CAAC,CAAE;QACzCnB,MAAM,CAACkB,KAAK,CAACE,QAAQ,CAACE,CAAC,IAAIH,SAAS,CAAE,CAAC,CAAE;QACzCnB,MAAM,CAACkB,KAAK,CAACE,QAAQ,CAACG,CAAC,IAAIJ,SAAS,CAAE,CAAC,CAAE;MAE1C;MAEA,OAAOnB,MAAM;IAEd,CAAC,CAAE;EAEL;AAED"},"metadata":{},"sourceType":"module","externalDependencies":[]}