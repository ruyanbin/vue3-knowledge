{"ast":null,"code":"import CRender from '@jiaminghi/c-render';\nimport '@jiaminghi/charts/lib/extend/index';\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index';\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util';\nexport default {\n  name: 'DvDigitalFlop',\n  props: {\n    config: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  data() {\n    return {\n      renderer: null,\n      defaultConfig: {\n        /**\n         * @description Number for digital flop\n         * @type {Array<Number>}\n         * @default number = []\n         * @example number = [10]\n         */\n        number: [],\n        /**\n         * @description Content formatter\n         * @type {String}\n         * @default content = ''\n         * @example content = '{nt}个'\n         */\n        content: '',\n        /**\n         * @description Number toFixed\n         * @type {Number}\n         * @default toFixed = 0\n         */\n        toFixed: 0,\n        /**\n         * @description Text align\n         * @type {String}\n         * @default textAlign = 'center'\n         * @example textAlign = 'center' | 'left' | 'right'\n         */\n        textAlign: 'center',\n        /**\n         * @description rowGap\n         * @type {Number}\n         @default rowGap = 0\n         */\n        rowGap: 0,\n        /**\n         * @description Text style configuration\n         * @type {Object} {CRender Class Style}\n         */\n        style: {\n          fontSize: 30,\n          fill: '#3de7c9'\n        },\n        /**\n         * @description Number formatter\n         * @type {Null|Function}\n         */\n        formatter: undefined,\n        /**\n         * @description CRender animationCurve\n         * @type {String}\n         * @default animationCurve = 'easeOutCubic'\n         */\n        animationCurve: 'easeOutCubic',\n        /**\n         * @description CRender animationFrame\n         * @type {String}\n         * @default animationFrame = 50\n         */\n        animationFrame: 50\n      },\n      mergedConfig: null,\n      graph: null\n    };\n  },\n  watch: {\n    config() {\n      const {\n        update\n      } = this;\n      update();\n    }\n  },\n  methods: {\n    init() {\n      const {\n        initRender,\n        mergeConfig,\n        initGraph\n      } = this;\n      initRender();\n      mergeConfig();\n      initGraph();\n    },\n    initRender() {\n      const {\n        $refs\n      } = this;\n      this.renderer = new CRender($refs['digital-flop']);\n    },\n    mergeConfig() {\n      const {\n        defaultConfig,\n        config\n      } = this;\n      this.mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {});\n    },\n    initGraph() {\n      const {\n        getShape,\n        getStyle,\n        renderer,\n        mergedConfig\n      } = this;\n      const {\n        animationCurve,\n        animationFrame\n      } = mergedConfig;\n      const shape = getShape();\n      const style = getStyle();\n      this.graph = renderer.add({\n        name: 'numberText',\n        animationCurve,\n        animationFrame,\n        shape,\n        style\n      });\n    },\n    getShape() {\n      const {\n        number,\n        content,\n        toFixed,\n        textAlign,\n        rowGap,\n        formatter\n      } = this.mergedConfig;\n      const [w, h] = this.renderer.area;\n      const position = [w / 2, h / 2];\n      if (textAlign === 'left') position[0] = 0;\n      if (textAlign === 'right') position[0] = w;\n      return {\n        number,\n        content,\n        toFixed,\n        position,\n        rowGap,\n        formatter\n      };\n    },\n    getStyle() {\n      const {\n        style,\n        textAlign\n      } = this.mergedConfig;\n      return deepMerge(style, {\n        textAlign,\n        textBaseline: 'middle'\n      });\n    },\n    update() {\n      const {\n        mergeConfig,\n        mergeShape,\n        getShape,\n        getStyle,\n        graph,\n        mergedConfig\n      } = this;\n      graph.animationEnd();\n      mergeConfig();\n      if (!graph) return;\n      const {\n        animationCurve,\n        animationFrame\n      } = mergedConfig;\n      const shape = getShape();\n      const style = getStyle();\n      mergeShape(graph, shape);\n      graph.animationCurve = animationCurve;\n      graph.animationFrame = animationFrame;\n      graph.animation('style', style, true);\n      graph.animation('shape', shape);\n    },\n    mergeShape(graph, shape) {\n      const cacheNum = graph.shape.number.length;\n      const shapeNum = shape.number.length;\n      if (cacheNum !== shapeNum) graph.shape.number = shape.number;\n    }\n  },\n  mounted() {\n    const {\n      init\n    } = this;\n    init();\n  }\n};","map":{"version":3,"mappings":"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","names":["CRender","deepMerge","deepClone","name","props","config","type","Object","default","data","renderer","defaultConfig","number","content","toFixed","textAlign","rowGap","style","fontSize","fill","formatter","undefined","animationCurve","animationFrame","mergedConfig","graph","watch","update","methods","init","initRender","mergeConfig","initGraph","$refs","getShape","getStyle","shape","add","w","h","area","position","textBaseline","mergeShape","animationEnd","animation","cacheNum","length","shapeNum","mounted"],"sourceRoot":"","sources":["/Users/yanbinru/Desktop/代码/github/vue3-knowledge/node_modules/@jiaminghi/data-view/lib/components/digitalFlop/src/main.vue"],"sourcesContent":["<template>\n  <div class=\"dv-digital-flop\">\n    <canvas ref=\"digital-flop\" />\n  </div>\n</template>\n\n<script>\nimport CRender from '@jiaminghi/c-render'\n\nimport '@jiaminghi/charts/lib/extend/index'\n\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\n\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\n\nexport default {\n  name: 'DvDigitalFlop',\n  props: {\n    config: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  data () {\n    return {\n      renderer: null,\n\n      defaultConfig: {\n        /**\n         * @description Number for digital flop\n         * @type {Array<Number>}\n         * @default number = []\n         * @example number = [10]\n         */\n        number: [],\n        /**\n         * @description Content formatter\n         * @type {String}\n         * @default content = ''\n         * @example content = '{nt}个'\n         */\n        content: '',\n        /**\n         * @description Number toFixed\n         * @type {Number}\n         * @default toFixed = 0\n         */\n        toFixed: 0,\n        /**\n         * @description Text align\n         * @type {String}\n         * @default textAlign = 'center'\n         * @example textAlign = 'center' | 'left' | 'right'\n         */\n        textAlign: 'center',\n        /**\n         * @description rowGap\n         * @type {Number}\n         @default rowGap = 0\n         */\n        rowGap: 0,\n        /**\n         * @description Text style configuration\n         * @type {Object} {CRender Class Style}\n         */\n        style: {\n          fontSize: 30,\n          fill: '#3de7c9'\n        },\n        /**\n         * @description Number formatter\n         * @type {Null|Function}\n         */\n        formatter: undefined,\n        /**\n         * @description CRender animationCurve\n         * @type {String}\n         * @default animationCurve = 'easeOutCubic'\n         */\n        animationCurve: 'easeOutCubic',\n        /**\n         * @description CRender animationFrame\n         * @type {String}\n         * @default animationFrame = 50\n         */\n        animationFrame: 50\n      },\n\n      mergedConfig: null,\n\n      graph: null\n    }\n  },\n  watch: {\n    config () {\n      const { update } = this\n\n      update()\n    }\n  },\n  methods: {\n    init () {\n      const { initRender, mergeConfig, initGraph } = this\n\n      initRender()\n\n      mergeConfig()\n\n      initGraph()\n    },\n    initRender () {\n      const { $refs } = this\n\n      this.renderer = new CRender($refs['digital-flop'])\n    },\n    mergeConfig () {\n      const { defaultConfig, config } = this\n\n      this.mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {})\n    },\n    initGraph () {\n      const { getShape, getStyle, renderer, mergedConfig } = this\n\n      const { animationCurve, animationFrame } = mergedConfig\n\n      const shape = getShape()\n      const style = getStyle()\n\n      this.graph = renderer.add({\n        name: 'numberText',\n        animationCurve,\n        animationFrame,\n        shape,\n        style\n      })\n    },\n    getShape () {\n      const { number, content, toFixed, textAlign, rowGap, formatter } = this.mergedConfig\n\n      const [w, h] = this.renderer.area\n\n      const position = [w / 2, h / 2]\n\n      if (textAlign === 'left') position[0] = 0\n      if (textAlign === 'right') position[0] = w\n\n      return {\n        number,\n        content,\n        toFixed,\n        position,\n        rowGap,\n        formatter\n      }\n    },\n    getStyle () {\n      const { style, textAlign } = this.mergedConfig\n\n      return deepMerge(style, {\n        textAlign,\n        textBaseline: 'middle'\n      })\n    },\n    update () {\n      const { mergeConfig, mergeShape, getShape, getStyle, graph, mergedConfig } = this\n\n      graph.animationEnd()\n\n      mergeConfig()\n\n      if (!graph) return\n\n      const { animationCurve, animationFrame } = mergedConfig\n\n      const shape = getShape()\n      const style = getStyle()\n\n      mergeShape(graph, shape)\n\n      graph.animationCurve = animationCurve\n      graph.animationFrame = animationFrame\n\n      graph.animation('style', style, true)\n      graph.animation('shape', shape)\n    },\n    mergeShape (graph, shape) {\n      const cacheNum = graph.shape.number.length\n      const shapeNum = shape.number.length\n\n      if (cacheNum !== shapeNum) graph.shape.number = shape.number\n    }\n  },\n  mounted () {\n    const { init } = this\n\n    init()\n  }\n}\n</script>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}