{"ast":null,"code":"import { arrayToString } from './arrayToString.js';\nexport class FeatureTable {\n  constructor(buffer, start, headerLength, binLength) {\n    this.buffer = buffer;\n    this.binOffset = start + headerLength;\n    this.binLength = binLength;\n    let header = null;\n    if (headerLength !== 0) {\n      const headerData = new Uint8Array(buffer, start, headerLength);\n      header = JSON.parse(arrayToString(headerData));\n    } else {\n      header = {};\n    }\n    this.header = header;\n  }\n  getKeys() {\n    return Object.keys(this.header);\n  }\n  getData(key, count, defaultComponentType = null, defaultType = null) {\n    const header = this.header;\n    if (!(key in header)) {\n      return null;\n    }\n    const feature = header[key];\n    if (!(feature instanceof Object)) {\n      return feature;\n    } else if (Array.isArray(feature)) {\n      return feature;\n    } else {\n      const {\n        buffer,\n        binOffset,\n        binLength\n      } = this;\n      const byteOffset = feature.byteOffset || 0;\n      const featureType = feature.type || defaultType;\n      const featureComponentType = feature.componentType || defaultComponentType;\n      if ('type' in feature && defaultType && feature.type !== defaultType) {\n        throw new Error('FeatureTable: Specified type does not match expected type.');\n      }\n      let stride;\n      switch (featureType) {\n        case 'SCALAR':\n          stride = 1;\n          break;\n        case 'VEC2':\n          stride = 2;\n          break;\n        case 'VEC3':\n          stride = 3;\n          break;\n        case 'VEC4':\n          stride = 4;\n          break;\n        default:\n          throw new Error(`FeatureTable : Feature type not provided for \"${key}\".`);\n      }\n      let data;\n      const arrayStart = binOffset + byteOffset;\n      const arrayLength = count * stride;\n      switch (featureComponentType) {\n        case 'BYTE':\n          data = new Int8Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'UNSIGNED_BYTE':\n          data = new Uint8Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'SHORT':\n          data = new Int16Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'UNSIGNED_SHORT':\n          data = new Uint16Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'INT':\n          data = new Int32Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'UNSIGNED_INT':\n          data = new Uint32Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'FLOAT':\n          data = new Float32Array(buffer, arrayStart, arrayLength);\n          break;\n        case 'DOUBLE':\n          data = new Float64Array(buffer, arrayStart, arrayLength);\n          break;\n        default:\n          throw new Error(`FeatureTable : Feature component type not provided for \"${key}\".`);\n      }\n      const dataEnd = arrayStart + arrayLength * data.BYTES_PER_ELEMENT;\n      if (dataEnd > binOffset + binLength) {\n        throw new Error('FeatureTable: Feature data read outside binary body length.');\n      }\n      return data;\n    }\n  }\n}\nexport class BatchTable extends FeatureTable {\n  constructor(buffer, batchSize, start, headerLength, binLength) {\n    super(buffer, start, headerLength, binLength);\n    this.batchSize = batchSize;\n  }\n  getData(key, componentType = null, type = null) {\n    return super.getData(key, this.batchSize, componentType, type);\n  }\n}","map":{"version":3,"names":["arrayToString","FeatureTable","constructor","buffer","start","headerLength","binLength","binOffset","header","headerData","Uint8Array","JSON","parse","getKeys","Object","keys","getData","key","count","defaultComponentType","defaultType","feature","Array","isArray","byteOffset","featureType","type","featureComponentType","componentType","Error","stride","data","arrayStart","arrayLength","Int8Array","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","dataEnd","BYTES_PER_ELEMENT","BatchTable","batchSize"],"sources":["/Users/yanbinru/Desktop/代码/github/vue3-knowledge/node_modules/3d-tiles-renderer/src/utilities/FeatureTable.js"],"sourcesContent":["import { arrayToString } from './arrayToString.js';\n\nexport class FeatureTable {\n\n\tconstructor( buffer, start, headerLength, binLength ) {\n\n\t\tthis.buffer = buffer;\n\t\tthis.binOffset = start + headerLength;\n\t\tthis.binLength = binLength;\n\n\t\tlet header = null;\n\t\tif ( headerLength !== 0 ) {\n\n\t\t\tconst headerData = new Uint8Array( buffer, start, headerLength );\n\t\t\theader = JSON.parse( arrayToString( headerData ) );\n\n\t\t} else {\n\n\t\t\theader = {};\n\n\t\t}\n\t\tthis.header = header;\n\n\t}\n\n\tgetKeys() {\n\n\t\treturn Object.keys( this.header );\n\n\t}\n\n\tgetData( key, count, defaultComponentType = null, defaultType = null ) {\n\n\t\tconst header = this.header;\n\n\t\tif ( ! ( key in header ) ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst feature = header[ key ];\n\t\tif ( ! ( feature instanceof Object ) ) {\n\n\t\t\treturn feature;\n\n\t\t} else if ( Array.isArray( feature ) ) {\n\n\t\t\treturn feature;\n\n\t\t} else {\n\n\t\t\tconst { buffer, binOffset, binLength } = this;\n\t\t\tconst byteOffset = feature.byteOffset || 0;\n\t\t\tconst featureType = feature.type || defaultType;\n\t\t\tconst featureComponentType = feature.componentType || defaultComponentType;\n\n\t\t\tif ( 'type' in feature && defaultType && feature.type !== defaultType ) {\n\n\t\t\t\tthrow new Error( 'FeatureTable: Specified type does not match expected type.' );\n\n\t\t\t}\n\n\t\t\tlet stride;\n\t\t\tswitch ( featureType ) {\n\n\t\t\t\tcase 'SCALAR':\n\t\t\t\t\tstride = 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'VEC2':\n\t\t\t\t\tstride = 2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'VEC3':\n\t\t\t\t\tstride = 3;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'VEC4':\n\t\t\t\t\tstride = 4;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error( `FeatureTable : Feature type not provided for \"${ key }\".` );\n\n\t\t\t}\n\n\t\t\tlet data;\n\t\t\tconst arrayStart = binOffset + byteOffset;\n\t\t\tconst arrayLength = count * stride;\n\n\t\t\tswitch ( featureComponentType ) {\n\n\t\t\t\tcase 'BYTE':\n\t\t\t\t\tdata = new Int8Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'UNSIGNED_BYTE':\n\t\t\t\t\tdata = new Uint8Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'SHORT':\n\t\t\t\t\tdata = new Int16Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'UNSIGNED_SHORT':\n\t\t\t\t\tdata = new Uint16Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'INT':\n\t\t\t\t\tdata = new Int32Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'UNSIGNED_INT':\n\t\t\t\t\tdata = new Uint32Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'FLOAT':\n\t\t\t\t\tdata = new Float32Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'DOUBLE':\n\t\t\t\t\tdata = new Float64Array( buffer, arrayStart, arrayLength );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error( `FeatureTable : Feature component type not provided for \"${ key }\".` );\n\n\t\t\t}\n\n\t\t\tconst dataEnd = arrayStart + arrayLength * data.BYTES_PER_ELEMENT;\n\t\t\tif ( dataEnd > binOffset + binLength ) {\n\n\t\t\t\tthrow new Error( 'FeatureTable: Feature data read outside binary body length.' );\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t}\n\n}\n\nexport class BatchTable extends FeatureTable {\n\n\tconstructor( buffer, batchSize, start, headerLength, binLength ) {\n\n\t\tsuper( buffer, start, headerLength, binLength );\n\t\tthis.batchSize = batchSize;\n\n\t}\n\n\tgetData( key, componentType = null, type = null ) {\n\n\t\treturn super.getData( key, this.batchSize, componentType, type );\n\n\t}\n\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}