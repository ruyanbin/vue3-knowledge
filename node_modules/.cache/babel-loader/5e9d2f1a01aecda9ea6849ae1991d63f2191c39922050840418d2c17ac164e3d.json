{"ast":null,"code":"// B3DM File Format\n// https://github.com/CesiumGS/3d-tiles/blob/master/specification/TileFormats/Batched3DModel/README.md\n\nimport { FeatureTable, BatchTable } from '../utilities/FeatureTable.js';\nimport { LoaderBase } from './LoaderBase.js';\nimport { readMagicBytes } from '../utilities/readMagicBytes.js';\nexport class B3DMLoaderBase extends LoaderBase {\n  parse(buffer) {\n    // TODO: this should be able to take a uint8array with an offset and length\n    const dataView = new DataView(buffer);\n\n    // 28-byte header\n\n    // 4 bytes\n    const magic = readMagicBytes(dataView);\n    console.assert(magic === 'b3dm');\n\n    // 4 bytes\n    const version = dataView.getUint32(4, true);\n    console.assert(version === 1);\n\n    // 4 bytes\n    const byteLength = dataView.getUint32(8, true);\n    console.assert(byteLength === buffer.byteLength);\n\n    // 4 bytes\n    const featureTableJSONByteLength = dataView.getUint32(12, true);\n\n    // 4 bytes\n    const featureTableBinaryByteLength = dataView.getUint32(16, true);\n\n    // 4 bytes\n    const batchTableJSONByteLength = dataView.getUint32(20, true);\n\n    // 4 bytes\n    const batchTableBinaryByteLength = dataView.getUint32(24, true);\n\n    // Feature Table\n    const featureTableStart = 28;\n    const featureTableBuffer = buffer.slice(featureTableStart, featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength);\n    const featureTable = new FeatureTable(featureTableBuffer, 0, featureTableJSONByteLength, featureTableBinaryByteLength);\n\n    // Batch Table\n    const batchTableStart = featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength;\n    const batchTableBuffer = buffer.slice(batchTableStart, batchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength);\n    const batchTable = new BatchTable(batchTableBuffer, featureTable.getData('BATCH_LENGTH'), 0, batchTableJSONByteLength, batchTableBinaryByteLength);\n    const glbStart = batchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength;\n    const glbBytes = new Uint8Array(buffer, glbStart, byteLength - glbStart);\n    return {\n      version,\n      featureTable,\n      batchTable,\n      glbBytes\n    };\n  }\n}","map":{"version":3,"names":["FeatureTable","BatchTable","LoaderBase","readMagicBytes","B3DMLoaderBase","parse","buffer","dataView","DataView","magic","console","assert","version","getUint32","byteLength","featureTableJSONByteLength","featureTableBinaryByteLength","batchTableJSONByteLength","batchTableBinaryByteLength","featureTableStart","featureTableBuffer","slice","featureTable","batchTableStart","batchTableBuffer","batchTable","getData","glbStart","glbBytes","Uint8Array"],"sources":["/Users/yanbinru/Desktop/代码/github/vue3-knowledge/node_modules/3d-tiles-renderer/src/base/B3DMLoaderBase.js"],"sourcesContent":["// B3DM File Format\n// https://github.com/CesiumGS/3d-tiles/blob/master/specification/TileFormats/Batched3DModel/README.md\n\nimport { FeatureTable, BatchTable } from '../utilities/FeatureTable.js';\nimport { LoaderBase } from './LoaderBase.js';\nimport { readMagicBytes } from '../utilities/readMagicBytes.js';\n\nexport class B3DMLoaderBase extends LoaderBase {\n\n\tparse( buffer ) {\n\n\t\t// TODO: this should be able to take a uint8array with an offset and length\n\t\tconst dataView = new DataView( buffer );\n\n\t\t// 28-byte header\n\n\t\t// 4 bytes\n\t\tconst magic = readMagicBytes( dataView );\n\n\t\tconsole.assert( magic === 'b3dm' );\n\n\t\t// 4 bytes\n\t\tconst version = dataView.getUint32( 4, true );\n\n\t\tconsole.assert( version === 1 );\n\n\t\t// 4 bytes\n\t\tconst byteLength = dataView.getUint32( 8, true );\n\n\t\tconsole.assert( byteLength === buffer.byteLength );\n\n\t\t// 4 bytes\n\t\tconst featureTableJSONByteLength = dataView.getUint32( 12, true );\n\n\t\t// 4 bytes\n\t\tconst featureTableBinaryByteLength = dataView.getUint32( 16, true );\n\n\t\t// 4 bytes\n\t\tconst batchTableJSONByteLength = dataView.getUint32( 20, true );\n\n\t\t// 4 bytes\n\t\tconst batchTableBinaryByteLength = dataView.getUint32( 24, true );\n\n\t\t// Feature Table\n\t\tconst featureTableStart = 28;\n\t\tconst featureTableBuffer = buffer.slice(\n\t\t\tfeatureTableStart,\n\t\t\tfeatureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength,\n\t\t);\n\t\tconst featureTable = new FeatureTable(\n\t\t\tfeatureTableBuffer,\n\t\t\t0,\n\t\t\tfeatureTableJSONByteLength,\n\t\t\tfeatureTableBinaryByteLength,\n\t\t);\n\n\t\t// Batch Table\n\t\tconst batchTableStart = featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength;\n\t\tconst batchTableBuffer = buffer.slice(\n\t\t\tbatchTableStart,\n\t\t\tbatchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength,\n\t\t);\n\t\tconst batchTable = new BatchTable(\n\t\t\tbatchTableBuffer,\n\t\t\tfeatureTable.getData( 'BATCH_LENGTH' ),\n\t\t\t0,\n\t\t\tbatchTableJSONByteLength,\n\t\t\tbatchTableBinaryByteLength,\n\t\t);\n\n\t\tconst glbStart = batchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength;\n\t\tconst glbBytes = new Uint8Array( buffer, glbStart, byteLength - glbStart );\n\n\t\treturn {\n\t\t\tversion,\n\t\t\tfeatureTable,\n\t\t\tbatchTable,\n\t\t\tglbBytes,\n\t\t};\n\n\t}\n\n}\n\n"],"mappings":"AAAA;AACA;;AAEA,SAASA,YAAY,EAAEC,UAAU,QAAQ,8BAA8B;AACvE,SAASC,UAAU,QAAQ,iBAAiB;AAC5C,SAASC,cAAc,QAAQ,gCAAgC;AAE/D,OAAO,MAAMC,cAAc,SAASF,UAAU,CAAC;EAE9CG,KAAK,CAAEC,MAAM,EAAG;IAEf;IACA,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,CAAEF,MAAM,CAAE;;IAEvC;;IAEA;IACA,MAAMG,KAAK,GAAGN,cAAc,CAAEI,QAAQ,CAAE;IAExCG,OAAO,CAACC,MAAM,CAAEF,KAAK,KAAK,MAAM,CAAE;;IAElC;IACA,MAAMG,OAAO,GAAGL,QAAQ,CAACM,SAAS,CAAE,CAAC,EAAE,IAAI,CAAE;IAE7CH,OAAO,CAACC,MAAM,CAAEC,OAAO,KAAK,CAAC,CAAE;;IAE/B;IACA,MAAME,UAAU,GAAGP,QAAQ,CAACM,SAAS,CAAE,CAAC,EAAE,IAAI,CAAE;IAEhDH,OAAO,CAACC,MAAM,CAAEG,UAAU,KAAKR,MAAM,CAACQ,UAAU,CAAE;;IAElD;IACA,MAAMC,0BAA0B,GAAGR,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAEjE;IACA,MAAMG,4BAA4B,GAAGT,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAEnE;IACA,MAAMI,wBAAwB,GAAGV,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAE/D;IACA,MAAMK,0BAA0B,GAAGX,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAEjE;IACA,MAAMM,iBAAiB,GAAG,EAAE;IAC5B,MAAMC,kBAAkB,GAAGd,MAAM,CAACe,KAAK,CACtCF,iBAAiB,EACjBA,iBAAiB,GAAGJ,0BAA0B,GAAGC,4BAA4B,CAC7E;IACD,MAAMM,YAAY,GAAG,IAAItB,YAAY,CACpCoB,kBAAkB,EAClB,CAAC,EACDL,0BAA0B,EAC1BC,4BAA4B,CAC5B;;IAED;IACA,MAAMO,eAAe,GAAGJ,iBAAiB,GAAGJ,0BAA0B,GAAGC,4BAA4B;IACrG,MAAMQ,gBAAgB,GAAGlB,MAAM,CAACe,KAAK,CACpCE,eAAe,EACfA,eAAe,GAAGN,wBAAwB,GAAGC,0BAA0B,CACvE;IACD,MAAMO,UAAU,GAAG,IAAIxB,UAAU,CAChCuB,gBAAgB,EAChBF,YAAY,CAACI,OAAO,CAAE,cAAc,CAAE,EACtC,CAAC,EACDT,wBAAwB,EACxBC,0BAA0B,CAC1B;IAED,MAAMS,QAAQ,GAAGJ,eAAe,GAAGN,wBAAwB,GAAGC,0BAA0B;IACxF,MAAMU,QAAQ,GAAG,IAAIC,UAAU,CAAEvB,MAAM,EAAEqB,QAAQ,EAAEb,UAAU,GAAGa,QAAQ,CAAE;IAE1E,OAAO;MACNf,OAAO;MACPU,YAAY;MACZG,UAAU;MACVG;IACD,CAAC;EAEF;AAED"},"metadata":{},"sourceType":"module","externalDependencies":[]}