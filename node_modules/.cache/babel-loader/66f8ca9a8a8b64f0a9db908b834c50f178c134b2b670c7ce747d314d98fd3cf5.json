{"ast":null,"code":"import autoResize from '../../../mixin/autoResize';\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index';\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util';\nexport default {\n  name: 'DvConicalColumnChart',\n  mixins: [autoResize],\n  props: {\n    config: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  data() {\n    return {\n      ref: 'conical-column-chart',\n      defaultConfig: {\n        /**\n         * @description Chart data\n         * @type {Array<Object>}\n         * @default data = []\n         */\n        data: [],\n        /**\n         * @description Chart img\n         * @type {Array<String>}\n         * @default img = []\n         */\n        img: [],\n        /**\n         * @description Chart font size\n         * @type {Number}\n         * @default fontSize = 12\n         */\n        fontSize: 12,\n        /**\n         * @description Img side length\n         * @type {Number}\n         * @default imgSideLength = 30\n         */\n        imgSideLength: 30,\n        /**\n         * @description Column color\n         * @type {String}\n         * @default columnColor = 'rgba(0, 194, 255, 0.4)'\n         */\n        columnColor: 'rgba(0, 194, 255, 0.4)',\n        /**\n         * @description Text color\n         * @type {String}\n         * @default textColor = '#fff'\n         */\n        textColor: '#fff',\n        /**\n         * @description Show value\n         * @type {Boolean}\n         * @default showValue = false\n         */\n        showValue: false\n      },\n      mergedConfig: null,\n      column: []\n    };\n  },\n  watch: {\n    config() {\n      const {\n        calcData\n      } = this;\n      calcData();\n    }\n  },\n  methods: {\n    afterAutoResizeMixinInit() {\n      const {\n        calcData\n      } = this;\n      calcData();\n    },\n    onResize() {\n      const {\n        calcData\n      } = this;\n      calcData();\n    },\n    calcData() {\n      const {\n        mergeConfig,\n        initData,\n        calcSVGPath\n      } = this;\n      mergeConfig();\n      initData();\n      calcSVGPath();\n    },\n    mergeConfig() {\n      const {\n        defaultConfig,\n        config\n      } = this;\n      this.mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {});\n    },\n    initData() {\n      const {\n        mergedConfig\n      } = this;\n      let {\n        data\n      } = mergedConfig;\n      data = deepClone(data, true);\n      data.sort(({\n        value: a\n      }, {\n        value: b\n      }) => {\n        if (a > b) return -1;\n        if (a < b) return 1;\n        if (a === b) return 0;\n      });\n      const max = data[0] ? data[0].value : 10;\n      data = data.map(item => ({\n        ...item,\n        percent: item.value / max\n      }));\n      mergedConfig.data = data;\n    },\n    calcSVGPath() {\n      const {\n        mergedConfig,\n        width,\n        height\n      } = this;\n      const {\n        imgSideLength,\n        fontSize,\n        data\n      } = mergedConfig;\n      const itemNum = data.length;\n      const gap = width / (itemNum + 1);\n      const useAbleHeight = height - imgSideLength - fontSize - 5;\n      const svgBottom = height - fontSize - 5;\n      this.column = data.map((item, i) => {\n        const {\n          percent\n        } = item;\n        const middleXPos = gap * (i + 1);\n        const leftXPos = gap * i;\n        const rightXpos = gap * (i + 2);\n        const middleYPos = svgBottom - useAbleHeight * percent;\n        const controlYPos = useAbleHeight * percent * 0.6 + middleYPos;\n        const d = `\n          M${leftXPos}, ${svgBottom}\n          Q${middleXPos}, ${controlYPos} ${middleXPos},${middleYPos}\n          M${middleXPos},${middleYPos}\n          Q${middleXPos}, ${controlYPos} ${rightXpos},${svgBottom}\n          L${leftXPos}, ${svgBottom}\n          Z\n        `;\n        const textY = (svgBottom + middleYPos) / 2 + fontSize / 2;\n        return {\n          ...item,\n          d,\n          x: middleXPos,\n          y: middleYPos,\n          textY\n        };\n      });\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["autoResize","deepMerge","deepClone","name","mixins","props","config","type","Object","default","data","ref","defaultConfig","img","fontSize","imgSideLength","columnColor","textColor","showValue","mergedConfig","column","watch","calcData","methods","afterAutoResizeMixinInit","onResize","mergeConfig","initData","calcSVGPath","sort","value","a","b","max","map","item","percent","width","height","itemNum","length","gap","useAbleHeight","svgBottom","i","middleXPos","leftXPos","rightXpos","middleYPos","controlYPos","d","textY","x","y"],"sourceRoot":"","sources":["/Users/yanbinru/Desktop/代码/github/vue3-knowledge/node_modules/@jiaminghi/data-view/lib/components/conicalColumnChart/src/main.vue"],"sourcesContent":["<template>\n  <div class=\"dv-conical-column-chart\" :ref=\"ref\">\n    <svg :width=\"width\" :height=\"height\">\n      <g\n        v-for=\"(item, i) in column\"\n        :key=\"i\"\n      >\n        <path\n          :d=\"item.d\"\n          :fill=\"mergedConfig.columnColor\"\n        />\n        <text\n          :style=\"`fontSize:${mergedConfig.fontSize}px`\"\n          :fill=\"mergedConfig.textColor\"\n          :x=\"item.x\"\n          :y=\"height - 4\"\n        >\n          {{ item.name }}\n        </text>\n        <image\n          v-if=\"mergedConfig.img.length\"\n          :xlink:href=\"mergedConfig.img[i % mergedConfig.img.length]\"\n          :width=\"mergedConfig.imgSideLength\"\n          :height=\"mergedConfig.imgSideLength\"\n          :x=\"item.x - mergedConfig.imgSideLength / 2\"\n          :y=\"item.y - mergedConfig.imgSideLength\"\n        />\n        <text\n          v-if=\"mergedConfig.showValue\"\n          :style=\"`fontSize:${mergedConfig.fontSize}px`\"\n          :fill=\"mergedConfig.textColor\"\n          :x=\"item.x\"\n          :y=\"item.textY\"\n        >\n          {{ item.value }}\n        </text>\n      </g>\n    </svg>\n  </div>\n</template>\n\n<script>\nimport autoResize from '../../../mixin/autoResize'\n\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\n\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\n\nexport default {\n  name: 'DvConicalColumnChart',\n  mixins: [autoResize],\n  props: {\n    config: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  data () {\n    return {\n      ref: 'conical-column-chart',\n\n      defaultConfig: {\n        /**\n         * @description Chart data\n         * @type {Array<Object>}\n         * @default data = []\n         */\n        data: [],\n        /**\n         * @description Chart img\n         * @type {Array<String>}\n         * @default img = []\n         */\n        img: [],\n        /**\n         * @description Chart font size\n         * @type {Number}\n         * @default fontSize = 12\n         */\n        fontSize: 12,\n        /**\n         * @description Img side length\n         * @type {Number}\n         * @default imgSideLength = 30\n         */\n        imgSideLength: 30,\n        /**\n         * @description Column color\n         * @type {String}\n         * @default columnColor = 'rgba(0, 194, 255, 0.4)'\n         */\n        columnColor: 'rgba(0, 194, 255, 0.4)',\n        /**\n         * @description Text color\n         * @type {String}\n         * @default textColor = '#fff'\n         */\n        textColor: '#fff',\n        /**\n         * @description Show value\n         * @type {Boolean}\n         * @default showValue = false\n         */\n        showValue: false\n      },\n\n      mergedConfig: null,\n\n      column: []\n    }\n  },\n  watch: {\n    config () {\n      const { calcData } = this\n\n      calcData()\n    }\n  },\n  methods: {\n    afterAutoResizeMixinInit () {\n      const { calcData } = this\n\n      calcData()\n    },\n    onResize () {\n      const { calcData } = this\n\n      calcData()\n    },\n    calcData () {\n      const { mergeConfig, initData, calcSVGPath } = this\n\n      mergeConfig()\n\n      initData()\n\n      calcSVGPath()\n    },\n    mergeConfig () {\n      const { defaultConfig, config } = this\n\n      this.mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {})\n    },\n    initData () {\n      const { mergedConfig } = this\n      let { data } = mergedConfig\n\n      data = deepClone(data, true)\n\n      data.sort(({ value: a }, { value: b }) => {\n        if (a > b) return -1\n        if (a < b) return 1\n        if (a === b) return 0\n      })\n\n      const max = data[0] ? data[0].value : 10\n\n      data = data.map(item => ({\n        ...item,\n        percent: item.value / max\n      }))\n\n      mergedConfig.data = data\n    },\n    calcSVGPath () {\n      const { mergedConfig, width, height } = this\n\n      const { imgSideLength, fontSize, data } = mergedConfig\n\n      const itemNum = data.length\n      const gap = width / (itemNum + 1)\n\n      const useAbleHeight = height - imgSideLength - fontSize - 5\n      const svgBottom = height - fontSize - 5\n\n      this.column = data.map((item, i) => {\n        const { percent } = item\n\n        const middleXPos = gap * (i + 1)\n        const leftXPos = gap * i\n        const rightXpos = gap * (i + 2)\n\n        const middleYPos = svgBottom - useAbleHeight * percent\n        const controlYPos = useAbleHeight * percent * 0.6 + middleYPos\n\n        const d = `\n          M${leftXPos}, ${svgBottom}\n          Q${middleXPos}, ${controlYPos} ${middleXPos},${middleYPos}\n          M${middleXPos},${middleYPos}\n          Q${middleXPos}, ${controlYPos} ${rightXpos},${svgBottom}\n          L${leftXPos}, ${svgBottom}\n          Z\n        `\n\n        const textY = (svgBottom + middleYPos) / 2 + fontSize / 2\n\n        return {\n          ...item,\n          d,\n          x: middleXPos,\n          y: middleYPos,\n          textY\n        }\n      })\n    }\n  }\n}\n</script>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}