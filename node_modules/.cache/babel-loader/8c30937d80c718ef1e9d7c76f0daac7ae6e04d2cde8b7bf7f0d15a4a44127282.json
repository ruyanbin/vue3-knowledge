{"ast":null,"code":"// PNTS File Format\n// https://github.com/CesiumGS/3d-tiles/blob/master/specification/TileFormats/PointCloud/README.md\n\nimport { FeatureTable, BatchTable } from '../utilities/FeatureTable.js';\nimport { readMagicBytes } from '../utilities/readMagicBytes.js';\nimport { LoaderBase } from './LoaderBase.js';\nexport class PNTSLoaderBase extends LoaderBase {\n  parse(buffer) {\n    const dataView = new DataView(buffer);\n\n    // 28-byte header\n\n    // 4 bytes\n    const magic = readMagicBytes(dataView);\n    console.assert(magic === 'pnts');\n\n    // 4 bytes\n    const version = dataView.getUint32(4, true);\n    console.assert(version === 1);\n\n    // 4 bytes\n    const byteLength = dataView.getUint32(8, true);\n    console.assert(byteLength === buffer.byteLength);\n\n    // 4 bytes\n    const featureTableJSONByteLength = dataView.getUint32(12, true);\n\n    // 4 bytes\n    const featureTableBinaryByteLength = dataView.getUint32(16, true);\n\n    // 4 bytes\n    const batchTableJSONByteLength = dataView.getUint32(20, true);\n\n    // 4 bytes\n    const batchTableBinaryByteLength = dataView.getUint32(24, true);\n\n    // Feature Table\n    const featureTableStart = 28;\n    const featureTableBuffer = buffer.slice(featureTableStart, featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength);\n    const featureTable = new FeatureTable(featureTableBuffer, 0, featureTableJSONByteLength, featureTableBinaryByteLength);\n\n    // Batch Table\n    const batchTableStart = featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength;\n    const batchTableBuffer = buffer.slice(batchTableStart, batchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength);\n    const batchTable = new BatchTable(batchTableBuffer, featureTable.getData('BATCH_LENGTH') || featureTable.getData('POINTS_LENGTH'), 0, batchTableJSONByteLength, batchTableBinaryByteLength);\n    return Promise.resolve({\n      version,\n      featureTable,\n      batchTable\n    });\n  }\n}","map":{"version":3,"names":["FeatureTable","BatchTable","readMagicBytes","LoaderBase","PNTSLoaderBase","parse","buffer","dataView","DataView","magic","console","assert","version","getUint32","byteLength","featureTableJSONByteLength","featureTableBinaryByteLength","batchTableJSONByteLength","batchTableBinaryByteLength","featureTableStart","featureTableBuffer","slice","featureTable","batchTableStart","batchTableBuffer","batchTable","getData","Promise","resolve"],"sources":["/Users/yanbinru/Desktop/代码/github/vue3-knowledge/node_modules/3d-tiles-renderer/src/base/PNTSLoaderBase.js"],"sourcesContent":["// PNTS File Format\n// https://github.com/CesiumGS/3d-tiles/blob/master/specification/TileFormats/PointCloud/README.md\n\nimport { FeatureTable, BatchTable } from '../utilities/FeatureTable.js';\nimport { readMagicBytes } from '../utilities/readMagicBytes.js';\nimport { LoaderBase } from './LoaderBase.js';\n\nexport class PNTSLoaderBase extends LoaderBase {\n\n\tparse( buffer ) {\n\n\t\tconst dataView = new DataView( buffer );\n\n\t\t// 28-byte header\n\n\t\t// 4 bytes\n\t\tconst magic = readMagicBytes( dataView );\n\n\t\tconsole.assert( magic === 'pnts' );\n\n\t\t// 4 bytes\n\t\tconst version = dataView.getUint32( 4, true );\n\n\t\tconsole.assert( version === 1 );\n\n\t\t// 4 bytes\n\t\tconst byteLength = dataView.getUint32( 8, true );\n\n\t\tconsole.assert( byteLength === buffer.byteLength );\n\n\t\t// 4 bytes\n\t\tconst featureTableJSONByteLength = dataView.getUint32( 12, true );\n\n\t\t// 4 bytes\n\t\tconst featureTableBinaryByteLength = dataView.getUint32( 16, true );\n\n\t\t// 4 bytes\n\t\tconst batchTableJSONByteLength = dataView.getUint32( 20, true );\n\n\t\t// 4 bytes\n\t\tconst batchTableBinaryByteLength = dataView.getUint32( 24, true );\n\n\t\t// Feature Table\n\t\tconst featureTableStart = 28;\n\t\tconst featureTableBuffer = buffer.slice(\n\t\t\tfeatureTableStart,\n\t\t\tfeatureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength,\n\t\t);\n\t\tconst featureTable = new FeatureTable(\n\t\t\tfeatureTableBuffer,\n\t\t\t0,\n\t\t\tfeatureTableJSONByteLength,\n\t\t\tfeatureTableBinaryByteLength,\n\t\t);\n\n\t\t// Batch Table\n\t\tconst batchTableStart = featureTableStart + featureTableJSONByteLength + featureTableBinaryByteLength;\n\t\tconst batchTableBuffer = buffer.slice(\n\t\t\tbatchTableStart,\n\t\t\tbatchTableStart + batchTableJSONByteLength + batchTableBinaryByteLength,\n\t\t);\n\t\tconst batchTable = new BatchTable(\n\t\t\tbatchTableBuffer,\n\t\t\tfeatureTable.getData( 'BATCH_LENGTH' ) || featureTable.getData( 'POINTS_LENGTH' ),\n\t\t\t0,\n\t\t\tbatchTableJSONByteLength,\n\t\t\tbatchTableBinaryByteLength,\n\t\t);\n\n\t\treturn Promise.resolve( {\n\n\t\t\tversion,\n\t\t\tfeatureTable,\n\t\t\tbatchTable,\n\n\t\t} );\n\n\t}\n\n}\n\n"],"mappings":"AAAA;AACA;;AAEA,SAASA,YAAY,EAAEC,UAAU,QAAQ,8BAA8B;AACvE,SAASC,cAAc,QAAQ,gCAAgC;AAC/D,SAASC,UAAU,QAAQ,iBAAiB;AAE5C,OAAO,MAAMC,cAAc,SAASD,UAAU,CAAC;EAE9CE,KAAK,CAAEC,MAAM,EAAG;IAEf,MAAMC,QAAQ,GAAG,IAAIC,QAAQ,CAAEF,MAAM,CAAE;;IAEvC;;IAEA;IACA,MAAMG,KAAK,GAAGP,cAAc,CAAEK,QAAQ,CAAE;IAExCG,OAAO,CAACC,MAAM,CAAEF,KAAK,KAAK,MAAM,CAAE;;IAElC;IACA,MAAMG,OAAO,GAAGL,QAAQ,CAACM,SAAS,CAAE,CAAC,EAAE,IAAI,CAAE;IAE7CH,OAAO,CAACC,MAAM,CAAEC,OAAO,KAAK,CAAC,CAAE;;IAE/B;IACA,MAAME,UAAU,GAAGP,QAAQ,CAACM,SAAS,CAAE,CAAC,EAAE,IAAI,CAAE;IAEhDH,OAAO,CAACC,MAAM,CAAEG,UAAU,KAAKR,MAAM,CAACQ,UAAU,CAAE;;IAElD;IACA,MAAMC,0BAA0B,GAAGR,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAEjE;IACA,MAAMG,4BAA4B,GAAGT,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAEnE;IACA,MAAMI,wBAAwB,GAAGV,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAE/D;IACA,MAAMK,0BAA0B,GAAGX,QAAQ,CAACM,SAAS,CAAE,EAAE,EAAE,IAAI,CAAE;;IAEjE;IACA,MAAMM,iBAAiB,GAAG,EAAE;IAC5B,MAAMC,kBAAkB,GAAGd,MAAM,CAACe,KAAK,CACtCF,iBAAiB,EACjBA,iBAAiB,GAAGJ,0BAA0B,GAAGC,4BAA4B,CAC7E;IACD,MAAMM,YAAY,GAAG,IAAItB,YAAY,CACpCoB,kBAAkB,EAClB,CAAC,EACDL,0BAA0B,EAC1BC,4BAA4B,CAC5B;;IAED;IACA,MAAMO,eAAe,GAAGJ,iBAAiB,GAAGJ,0BAA0B,GAAGC,4BAA4B;IACrG,MAAMQ,gBAAgB,GAAGlB,MAAM,CAACe,KAAK,CACpCE,eAAe,EACfA,eAAe,GAAGN,wBAAwB,GAAGC,0BAA0B,CACvE;IACD,MAAMO,UAAU,GAAG,IAAIxB,UAAU,CAChCuB,gBAAgB,EAChBF,YAAY,CAACI,OAAO,CAAE,cAAc,CAAE,IAAIJ,YAAY,CAACI,OAAO,CAAE,eAAe,CAAE,EACjF,CAAC,EACDT,wBAAwB,EACxBC,0BAA0B,CAC1B;IAED,OAAOS,OAAO,CAACC,OAAO,CAAE;MAEvBhB,OAAO;MACPU,YAAY;MACZG;IAED,CAAC,CAAE;EAEJ;AAED"},"metadata":{},"sourceType":"module","externalDependencies":[]}